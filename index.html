<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Wi-Fi Connect</title>
<link rel="manifest" href="manifest.json">

<style>
:root{
  --accent:#9b75ff;
  --accent2:#c5a0ff;
  --bg1:#1a0f35;
  --bg2:#070017;
  --card-bg:rgba(15,0,40,0.92);
  --text:#f3ebff;
}

*{box-sizing:border-box;margin:0;padding:0;}

body{
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif;
  background:radial-gradient(circle at top,var(--bg1),var(--bg2));
  min-height:100vh;
  color:var(--text);
  overflow-x:hidden;
}

.wrapper{
  max-width:520px;
  margin:40px auto;
  padding:16px;
}

h1{
  text-align:center;
  font-size:26px;
  margin-bottom:16px;
}

.welcome{
  text-align:center;
  font-size:15px;
  opacity:.9;
  margin-bottom:6px;
}

/* –≤–Ω–µ—à–Ω—è—è –∫–∞—Ä—Ç–æ—á–∫–∞ */
.card{
  background:var(--card-bg);
  border-radius:28px;
  padding:24px 24px 22px;
  box-shadow:0 22px 70px rgba(0,0,0,0.6);
  position:relative;
  touch-action: pan-y;
  user-select:none;
  -webkit-user-select:none;
}

/* --- HERO ART (–≤–µ—Ä—Ö–Ω–∏–π –±–∞–Ω–Ω–µ—Ä —Å –¥—Ä–æ–∏–¥–æ–º –ø–æ —Å–µ—Ç–∏) --- */
.hero-art{
  width:100%;
  height:170px;
  margin:0 auto 10px auto;
  display:flex;
  justify-content:center;
  align-items:flex-end;
  overflow:hidden;
  position:relative;
}
.hero-art img{
  width:100%;
  max-width:460px;
  height:auto;
  object-fit:contain;
  border-radius:20px;
  filter:drop-shadow(0 18px 40px rgba(0,0,0,0.7));
  transition:opacity .45s ease, transform .45s ease;
}
.hero-art img.fade-enter{
  opacity:0;
  transform:scale(0.97);
}

/* –∫–∞—Ä—É—Å–µ–ª—å */
.carousel-shell{
  position:relative;
}
.carousel{
  position:relative;
  height:340px;
  overflow:hidden;
}
.track{
  display:flex;
  height:100%;
  transform:translateX(0);
  transition:transform 0.7s cubic-bezier(.22,.61,.36,1);
}
.slide{
  flex:0 0 100%;
  height:100%;
  display:flex;
  align-items:center;
  justify-content:center;
}

/* –≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞ —Å–µ—Ç–∏ */
.slide-card{
  width:100%;
  max-width:480px;
  height:260px;
  margin:auto;
  border-radius:32px;
  padding:26px 28px 20px;
  background:radial-gradient(circle at top,#2b184f,#0b021e);
  border:1px solid rgba(190,155,255,0.7);
  box-shadow:
    0 0 0 1px rgba(80,40,160,0.7),
    0 20px 40px rgba(0,0,0,0.8);
  display:flex;
  flex-direction:column;
  justify-content:space-between;
}
.slide-inner{
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:flex-start;
  flex:1;
}
.slide-inner img{
  width:120px;
  max-height:140px;
  object-fit:contain;
  margin-bottom:10px;
  filter:drop-shadow(0 0 18px rgba(170,140,255,0.7));
  -webkit-user-drag:none;
  user-drag:none;
}
.slide-ssid-main{
  font-size:24px;
  font-weight:600;
  margin-top:2px;
}
.slide-ssid-sub{
  font-size:16px;
  opacity:.85;
}
.slide-caption{
  text-align:center;
  font-size:14px;
  opacity:.85;
  margin-top:10px;
}

/* —Å—Ç—Ä–µ–ª–∫–∏ */
.nav-arrow{
  position:absolute;
  top:50%;
  transform:translateY(-50%);
  width:52px;
  height:52px;
  border-radius:50%;
  background:rgba(0,0,0,0.55);
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;
  z-index:20;
  backdrop-filter:blur(3px);
}
.nav-arrow.left{ left:-26px; }
.nav-arrow.right{ right:-26px; }
.nav-arrow img{
  width:22px;
  pointer-events:none;
  -webkit-user-drag:none;
  user-drag:none;
}

/* —Ç–æ—á–∫–∏ */
.dots{
  text-align:center;
  margin-top:8px;
}
.dots span{
  width:10px;height:10px;
  display:inline-block;
  margin:0 4px;
  border-radius:50%;
  background:#5d4f94;
  transition:.2s;
}
.dots span.active{
  background:var(--accent);
  box-shadow:0 0 10px var(--accent);
}

/* –∫–Ω–æ–ø–∫–∏ */
.btn{
  width:100%;
  padding:15px;
  border-radius:18px;
  border:none;
  font-size:16px;
  background:linear-gradient(135deg,var(--accent),var(--accent2));
  color:white;
  margin-top:12px;
  cursor:pointer;
  box-shadow:0 12px 32px rgba(0,0,0,0.55);
  transition:.12s;
}
.btn:hover{
  transform:translateY(-1px);
  filter:brightness(1.04);
}

/* QR */
.qr{
  display:none;
  text-align:center;
  margin-top:16px;
}
#qrCanvas{
  display:inline-block;
  width:200px;height:200px;
  background:white;
  padding:10px;
  border-radius:14px;
}

/* –ø–æ–¥–ø–∏—Å–∏ –ø–æ–¥ –±–ª–æ–∫–æ–º */
.helper{
  margin-top:10px;
  font-size:13px;
  opacity:.9;
  text-align:center;
}
.status{
  margin-top:6px;
  font-size:12px;
  text-align:center;
  opacity:.8;
}

/* –Ω–∏–∂–Ω–∏–π –±–ª–æ–∫: –∞—Ä—Ç-–±–∞–Ω–Ω–µ—Ä + –ø–æ–≥–æ–¥–∞ */
.bottom-section{
  margin-top:16px;
  display:flex;
  flex-direction:column;
  gap:10px;
}

/* –±–∞–Ω–Ω–µ—Ä –ø–æ –≤—Ä–µ–º–µ–Ω–∏ —Å—É—Ç–æ–∫ + –ø–æ–≥–æ–¥–µ */
.time-banner{
  border-radius:18px;
  padding:10px 14px;
  background:rgba(255,255,255,0.02);
  border:1px dashed rgba(200,170,255,0.55);
  display:flex;
  align-items:center;
  gap:10px;
}
.time-banner-art{
  width:56px;
  height:56px;
  border-radius:20px;
  background-size:cover;
  background-position:center;
  background-repeat:no-repeat;
  box-shadow:0 0 20px rgba(150,120,255,0.8);
  flex-shrink:0;
}
.time-banner-text{
  display:flex;
  flex-direction:column;
}
.time-banner-title{
  font-size:14px;
  font-weight:600;
  letter-spacing:.03em;
  text-transform:uppercase;
  opacity:.95;
}
.time-banner-sub{
  font-size:13px;
  opacity:.88;
}

/* –∫–∞—Ä—Ç–æ—á–∫–∞ –ø–æ–≥–æ–¥—ã */
.weather-card{
  border-radius:18px;
  padding:10px 14px 11px;
  background:rgba(255,255,255,0.02);
  border:1px solid rgba(200,170,255,0.35);
  font-size:13px;
}
.weather-row{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:4px;
}
.weather-city{
  font-weight:600;
}
.weather-main{
  opacity:.9;
}
.weather-temp{
  font-size:20px;
  font-weight:600;
  margin-bottom:2px;
}
.weather-meta{
  font-size:12px;
  opacity:.8;
}

/* –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Ç–µ–º—ã */
.theme-toggle{
  position:fixed;
  top:14px;right:14px;
  width:46px;height:46px;
  border-radius:50%;
  background:rgba(0,0,0,0.4);
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:23px;
  color:#ffd98a;
  cursor:pointer;
  z-index:40;
}

/* –∫–Ω–æ–ø–∫–∞ –∞–¥–º–∏–Ω–∫–∏ */
.admin-toggle{
  position:fixed;
  right:16px;
  bottom:16px;
  width:34px;
  height:34px;
  border-radius:50%;
  background:rgba(0,0,0,0.55);
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:18px;
  color:#f5e9ff;
  cursor:pointer;
  z-index:45;
  box-shadow:0 6px 18px rgba(0,0,0,0.6);
}

/* –ø–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∫–∏ */
.admin-panel{
  position:fixed;
  inset:0;
  z-index:44;
  pointer-events:none;
}
.admin-panel.open{
  pointer-events:auto;
}
.admin-backdrop{
  position:absolute;
  inset:0;
  background:rgba(0,0,0,0.4);
  backdrop-filter:blur(3px);
  opacity:0;
  transition:opacity .25s ease-out;
}
.admin-panel.open .admin-backdrop{
  opacity:1;
}
.admin-inner{
  position:absolute;
  left:0;right:0;
  bottom:0;
  max-width:520px;
  margin:0 auto;
  background:rgba(16,8,40,0.96);
  color:#f3ebff;
  padding:16px 18px 14px;
  border-radius:22px 22px 0 0;
  box-shadow:0 -10px 30px rgba(0,0,0,0.7);
  transform:translateY(100%);
  transition:transform .25s ease-out;
}
.admin-panel.open .admin-inner{
  transform:translateY(0);
}
.admin-inner h2{
  font-size:18px;
  margin-bottom:8px;
}
.admin-row{
  display:flex;
  flex-direction:column;
  margin-bottom:8px;
}
.admin-row label{
  font-size:12px;
  opacity:.9;
  margin-bottom:2px;
}
.admin-row input,
.admin-row textarea{
  border-radius:10px;
  border:none;
  padding:7px 9px;
  font-size:13px;
  font-family:inherit;
  background:rgba(255,255,255,0.06);
  color:#f3ebff;
}
.admin-row textarea{
  resize:vertical;
  min-height:40px;
}
.admin-actions{
  display:flex;
  justify-content:space-between;
  gap:8px;
  margin-top:6px;
}
.admin-btn{
  flex:1;
  border-radius:999px;
  border:none;
  padding:8px 10px;
  font-size:13px;
  cursor:pointer;
}
.admin-btn.save{
  background:linear-gradient(135deg,var(--accent),var(--accent2));
  color:white;
}
.admin-btn.reset{
  background:rgba(255,255,255,0.08);
  color:#f3ebff;
}
.admin-close{
  position:absolute;
  right:10px;top:8px;
  font-size:18px;
  cursor:pointer;
  opacity:.8;
}

/* —Å–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞ */
body.light{
  background:radial-gradient(circle at top,#f5f2ff,#d9e3ff);
  color:#1b1035;
}
body.light .card{
  background:rgba(255,255,255,0.96);
  box-shadow:0 18px 50px rgba(0,0,0,0.18);
}
body.light .slide-card{
  background:radial-gradient(circle at top,#ffffff,#dde3ff);
  border-color:rgba(110,95,200,0.7);
  box-shadow:
    0 0 0 1px rgba(160,150,230,0.7),
    0 16px 30px rgba(0,0,0,0.12);
}
body.light .dots span{
  background:#b5addd;
}
body.light .dots span.active{
  background:#7a5cff;
}
body.light .time-banner,
body.light .weather-card{
  background:rgba(255,255,255,0.9);
  border-color:rgba(140,120,230,0.4);
}
body.light .time-banner-sub,
body.light .weather-meta{
  opacity:.9;
}
body.light .admin-inner{
  background:rgba(255,255,255,0.98);
  color:#1a1235;
}
body.light .admin-row input,
body.light .admin-row textarea{
  background:rgba(10,0,40,0.04);
  color:#1a1235;
}
body.light .admin-btn.reset{
  background:rgba(10,0,40,0.04);
}

/* —Ç—ë–º–Ω–∞—è (–Ω–µ–æ–Ω–æ–≤–∞—è) */
body.neon{
  background:radial-gradient(circle at top,#060012,#000);
}
</style>
</head>
<body>

<div class="theme-toggle" onclick="toggleTheme()">‚òÄÔ∏è</div>
<div class="admin-toggle" onclick="toggleAdmin()">‚öôÔ∏è</div>

<div class="wrapper">
  <div class="welcome" id="welcomeText">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å! –ß—É–≤—Å—Ç–≤—É–π —Å–µ–±—è –∫–∞–∫ –¥–æ–º–∞ üß°</div>
  <h1>–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Wi-Fi</h1>

  <div class="card">

    <!-- –≤–µ—Ä—Ö–Ω–∏–π –∞—Ä—Ç-–¥—Ä–æ–∏–¥ (–ø–æ —Å–µ—Ç–∏) -->
    <div class="hero-art">
      <img id="heroArt" src="icons/hero_r2d5.svg" alt="Wi-Fi droid art">
    </div>

    <div class="carousel-shell">
      <div class="carousel" id="carousel">
        <div class="track" id="track">

          <!-- 5 GHz -->
          <div class="slide" data-net="r2d5">
            <div class="slide-card">
              <div class="slide-inner">
                <img src="icons/icon_r2d5.svg" alt="r2d5">
                <div class="slide-ssid-main">r2d5</div>
                <div class="slide-ssid-sub">5 GHz</div>
              </div>
              <div class="slide-caption">
                r2d5 ¬∑ –±—ã—Å—Ç—Ä–µ–µ, –µ—Å–ª–∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è
              </div>
            </div>
          </div>

          <!-- 2.4 GHz -->
          <div class="slide" data-net="r2d2">
            <div class="slide-card">
              <div class="slide-inner">
                <img src="icons/icon_r2d2.svg" alt="r2d2">
                <div class="slide-ssid-main">r2d2</div>
                <div class="slide-ssid-sub">2.4 GHz</div>
              </div>
              <div class="slide-caption">
                r2d2 ¬∑ —Å—Ç–∞–±–∏–ª—å–Ω–µ–µ –Ω–∞ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–∏
              </div>
            </div>
          </div>

        </div>
      </div>

      <!-- —Å—Ç—Ä–µ–ª–∫–∏ -->
      <div class="nav-arrow left" onclick="prevSlide()">
        <img src="icons/arrow_left.svg" alt="">
      </div>
      <div class="nav-arrow right" onclick="nextSlide()">
        <img src="icons/arrow_right.svg" alt="">
      </div>
    </div>

    <!-- —Ç–æ—á–∫–∏ -->
    <div class="dots" id="dots">
      <span class="active"></span>
      <span></span>
    </div>

    <!-- –∫–Ω–æ–ø–∫–∏ -->
    <button class="btn" onclick="autoConnect()">–ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ (Android)</button>
    <button class="btn" onclick="showQR()">–ü–æ–∫–∞–∑–∞—Ç—å QR-–∫–æ–¥</button>
    <button class="btn" onclick="copyPass()">–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –ø–∞—Ä–æ–ª—å</button>
    <button class="btn" onclick="openMaps()">–ö–∞–∫ –¥–æ–±—Ä–∞—Ç—å—Å—è üöï</button>

    <!-- QR -->
    <div class="qr" id="qrBox">
      <div id="qrCanvas"></div>
    </div>

    <!-- –ø–æ–¥–ø–∏—Å–∏ -->
    <div class="helper" id="helperText"></div>
    <div class="status" id="netStatus"></div>

    <!-- –Ω–∏–∂–Ω–∏–π –±–ª–æ–∫: –±–∞–Ω–Ω–µ—Ä + –ø–æ–≥–æ–¥–∞ -->
    <div class="bottom-section">
      <div class="time-banner" id="timeBanner">
        <div class="time-banner-art" id="timeBannerArt"></div>
        <div class="time-banner-text">
          <div class="time-banner-title" id="timeBannerTitle"></div>
          <div class="time-banner-sub" id="timeBannerSub"></div>
        </div>
      </div>

      <div class="weather-card" id="weatherCard">
        <div class="weather-row">
          <span class="weather-city" id="weatherCity"></span>
          <span class="weather-main" id="weatherMain"></span>
        </div>
        <div class="weather-temp" id="weatherTemp"></div>
        <div class="weather-meta" id="weatherMeta"></div>
      </div>
    </div>

  </div>
</div>

<!-- –ú–∏–Ω–∏-–∞–¥–º–∏–Ω–∫–∞ -->
<div class="admin-panel" id="adminPanel">
  <div class="admin-backdrop" onclick="toggleAdmin()"></div>
  <div class="admin-inner">
    <div class="admin-close" onclick="toggleAdmin()">‚úï</div>
    <h2>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è —Ö–æ–∑—è–∏–Ω–∞</h2>

    <div class="admin-row">
      <label for="admWelcome">–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ</label>
      <input id="admWelcome" type="text" placeholder="–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!">
    </div>

    <div class="admin-row">
      <label for="admSsid5">–ò–º—è —Å–µ—Ç–∏ 5 GHz</label>
      <input id="admSsid5" type="text" placeholder="r2d5">
    </div>
    <div class="admin-row">
      <label for="admSsid24">–ò–º—è —Å–µ—Ç–∏ 2.4 GHz</label>
      <input id="admSsid24" type="text" placeholder="r2d2">
    </div>

    <div class="admin-row">
      <label for="admPass">–ü–∞—Ä–æ–ª—å Wi-Fi</label>
      <input id="admPass" type="text" placeholder="–ü–∞—Ä–æ–ª—å">
    </div>

    <div class="admin-row">
      <label for="admMaps">–°—Å—ã–ª–∫–∞ ¬´–ö–∞–∫ –¥–æ–±—Ä–∞—Ç—å—Å—è¬ª</label>
      <input id="admMaps" type="text" placeholder="https://www.google.com/maps">
    </div>

    <div class="admin-row">
      <label for="admCity">–ì–æ—Ä–æ–¥ –¥–ª—è –ø–æ–≥–æ–¥—ã</label>
      <input id="admCity" type="text" placeholder="Kyiv">
    </div>

    <div class="admin-row">
      <label for="admWeatherKey">API-–∫–ª—é—á OpenWeather (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</label>
      <input id="admWeatherKey" type="text" placeholder="—Å–∫–æ–ø–∏—Ä—É–π —Å openweathermap.org">
    </div>

    <div class="admin-actions">
      <button class="admin-btn reset" onclick="resetConfig()">–°–±—Ä–æ—Å–∏—Ç—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é</button>
      <button class="admin-btn save" onclick="saveConfig()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>

<script>
/* ---------- –ö–æ–Ω—Ñ–∏–≥ + localStorage ---------- */
const defaultConfig = {
  ssid5: "r2d5",
  ssid24: "r2d2",
  pass: "Jgthfnbdysq1913",
  welcome: "–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å! –ß—É–≤—Å—Ç–≤—É–π —Å–µ–±—è –∫–∞–∫ –¥–æ–º–∞ üß°",
  mapsUrl: "https://www.google.com/maps",
  city: "Kyiv",
  weatherApiKey: "" // —Å—é–¥–∞ –º–æ–∂–Ω–æ –≤–≤–µ—Å—Ç–∏ –∫–ª—é—á OpenWeather
};

let CONFIG = loadConfig();

function loadConfig(){
  try{
    const saved = localStorage.getItem("wifiGuestConfig");
    if(saved){
      const obj = JSON.parse(saved);

      if(obj.mapsUrl && /maps\.app\.goo\.gl\/XXXXXXXX/i.test(obj.mapsUrl)){
        delete obj.mapsUrl;
      }

      return Object.assign({}, defaultConfig, obj);
    }
  }catch(e){}
  return { ...defaultConfig };
}

function saveConfigToStorage(){
  try{
    localStorage.setItem("wifiGuestConfig", JSON.stringify(CONFIG));
  }catch(e){}
}

/* ---------- DOM ---------- */
const track       = document.getElementById("track");
const carousel    = document.getElementById("carousel");
const card        = document.querySelector(".card");
const helperText  = document.getElementById("helperText");
const netStatus   = document.getElementById("netStatus");
const dots        = document.querySelectorAll(".dots span");
const welcomeEl   = document.getElementById("welcomeText");
const heroArtEl   = document.getElementById("heroArt");
const adminPanelEl= document.getElementById("adminPanel");

let slides        = Array.from(document.querySelectorAll(".slide"));
const REAL_COUNT  = slides.length;

let index       = 1; // –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫–ª–æ–Ω–æ–≤
let qrObj       = null;
let slideWidth  = 0;
let isAnimating = false;
let audioCtx    = null;

const transitionValue = "transform 0.7s cubic-bezier(.22,.61,.36,1)";

/* –¥–µ—Ç–µ–∫—Ç —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ */
const ua = navigator.userAgent.toLowerCase();
const isIOS     = /iphone|ipad|ipod/.test(ua);
const isAndroid = /android/.test(ua);
const isDesktop = !isIOS && !isAndroid;

const oldAndroid = /android\s([0-6]\.|7\.0)/i.test(ua);
const oldIOS     = /os\s(9_|10_)/i.test(ua);

/* ---------- –±–µ—Å–∫–æ–Ω–µ—á–Ω–∞—è –ª–µ–Ω—Ç–∞ ---------- */
const firstClone = slides[0].cloneNode(true);
const lastClone  = slides[REAL_COUNT - 1].cloneNode(true);
track.appendChild(firstClone);
track.insertBefore(lastClone, track.firstChild);
slides = Array.from(document.querySelectorAll(".slide"));

/* ---------- helpers –ø–æ —Å–µ—Ç–∏ ---------- */
function getCurrentBand(){
  const logical = (index - 1 + REAL_COUNT) % REAL_COUNT;
  return logical === 0 ? "5" : "24";
}
function getSsidForBand(band){
  return band === "5" ? CONFIG.ssid5 : CONFIG.ssid24;
}
function getCurrentSsid(){
  return getSsidForBand(getCurrentBand());
}

/* ---------- –≤–µ—Ä—Ö–Ω–∏–π –∞—Ä—Ç-–¥—Ä–æ–∏–¥ –ø–æ —Å–µ—Ç–∏ ---------- */
const HERO_ART = {
  "5":  "icons/hero_r2d5.svg",
  "24": "icons/hero_r2d2.svg"
};

function updateHeroArt(){
  if(!heroArtEl) return;
  const band = getCurrentBand();
  const src = HERO_ART[band] || HERO_ART["5"];
  if(heroArtEl.src.includes(src)) return;

  heroArtEl.classList.add("fade-enter");
  setTimeout(()=>{
    heroArtEl.src = src;
    requestAnimationFrame(()=>{
      heroArtEl.classList.remove("fade-enter");
    });
  },200);
}

/* ---------- –±–∞–Ω–Ω–µ—Ä –ø–æ –≤—Ä–µ–º–µ–Ω–∏ —Å—É—Ç–æ–∫ + –ø–æ–≥–æ–¥–µ ---------- */
const TIME_BANNERS = [
  {
    from: 5, to: 11,
    baseTitle: "–î–æ–±—Ä–æ–µ —É—Ç—Ä–æ",
    baseSub:   "–ö–æ—Ñ–µ, Wi-Fi –∏ –¥—Ä–æ–∏–¥ —É–∂–µ –Ω–∞ –ø–æ—Å—Ç—É.",
    theme: "morning"
  },
  {
    from: 11, to: 18,
    baseTitle: "–•–æ—Ä–æ—à–µ–≥–æ –¥–Ω—è",
    baseSub:   "–ò–Ω—Ç–µ—Ä–Ω–µ—Ç –µ—Å—Ç—å ‚Äî –º–æ–∂–Ω–æ —Ç–≤–æ—Ä–∏—Ç—å —á—É–¥–µ—Å–∞.",
    theme: "day"
  },
  {
    from: 18, to: 23,
    baseTitle: "–£—é—Ç–Ω—ã–π –≤–µ—á–µ—Ä",
    baseSub:   "–°–µ—Ä–∏–∞–ª—ã, –∏–≥—Ä—ã –∏ –ª–∞–º–ø–æ–≤—ã–π Wi-Fi.",
    theme: "evening"
  },
  {
    from: 23, to: 5,
    baseTitle: "–ù–æ—á–Ω–æ–π —Ä–µ–∂–∏–º",
    baseSub:   "–†–æ—É—Ç–µ—Ä –Ω–µ —Å–ø–∏—Ç, –¥–∞–∂–µ –µ—Å–ª–∏ —Ç—ã —É–∂–µ –¥–∞.",
    theme: "night"
  }
];

let lastWeatherKind = null; // "clear" | "rain" | "snow" | "clouds" | "other"

function pickTimeBannerConfig(hour){
  let cfg = TIME_BANNERS[0];
  for(const b of TIME_BANNERS){
    if(b.from < b.to){
      if(hour >= b.from && hour < b.to){ cfg = b; break; }
    }else{
      if(hour >= b.from || hour < b.to){ cfg = b; break; }
    }
  }
  return cfg;
}

function getArtForBanner(theme, weatherKind){
  // –≤—Å–µ–≥–æ –¥–≤–∞ –≥–µ—Ä–æ—è, –Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º –∏—Ö –ø–æ-—Ä–∞–∑–Ω–æ–º—É
  if(weatherKind === "snow"){
    // —Å–Ω–µ–≥ ‚Äî –ø—É—Å—Ç—å –±—É–¥–µ—Ç –±–æ–ª–µ–µ "—Ö–æ–ª–æ–¥–Ω—ã–π" —Ü–∏–ª–∏–Ω–¥—Ä–∏—á–µ—Å–∫–∏–π
    return "icons/hero_r2d2.svg";
  }
  if(weatherKind === "rain"){
    // –¥–æ–∂–¥—å ‚Äî –∫—Ä—É–≥–ª—ã–π –¥—Ä–æ–∏–¥
    return "icons/hero_r2d5.svg";
  }
  if(weatherKind === "clear"){
    // —è—Å–Ω–∞—è –ø–æ–≥–æ–¥–∞ ‚Äî –≤—ã–±–∏—Ä–∞–µ–º –ø–æ –≤—Ä–µ–º–µ–Ω–∏ –¥–Ω—è
    return theme === "night" ? "icons/hero_r2d2.svg" : "icons/hero_r2d5.svg";
  }
  if(weatherKind === "clouds"){
    return theme === "day" ? "icons/hero_r2d2.svg" : "icons/hero_r2d5.svg";
  }
  // –≤—Å—ë –æ—Å—Ç–∞–ª—å–Ω–æ–µ
  return theme === "night" ? "icons/hero_r2d2.svg" : "icons/hero_r2d5.svg";
}

function buildBannerText(baseTitle, baseSub, weatherKind){
  switch(weatherKind){
    case "clear":
      return {
        title: baseTitle + " ‚òÄÔ∏è",
        sub: baseSub
      };
    case "rain":
      return {
        title: baseTitle + " ¬∑ –¥–æ–∂–¥—å –∑–∞ –æ–∫–Ω–æ–º üåß",
        sub: "–ì–ª–∞–≤–Ω–æ–µ ‚Äî Wi-Fi —Å—É—Ö–æ–π –∏ –±—ã—Å—Ç—Ä—ã–π."
      };
    case "snow":
      return {
        title: baseTitle + " ¬∑ —Å–Ω–µ–≥–æ–ø–∞–¥ ‚ùÑÔ∏è",
        sub: "–ú–æ–∂–Ω–æ –Ω–µ –≤—ã—Ö–æ–¥–∏—Ç—å ‚Äî –∑–¥–µ—Å—å –∏ —Ç–µ–ø–ª–æ, –∏ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç."
      };
    case "clouds":
      return {
        title: baseTitle + " ¬∑ –ø–∞—Å–º—É—Ä–Ω–æ ‚õÖ",
        sub: "–ó–∞—Ç–æ –¥–æ–º–∞ —É—é—Ç–Ω–æ –∏ —Å—Ç–∞–±–∏–ª—å–Ω—ã–π —Å–∏–≥–Ω–∞–ª."
      };
    default:
      return {
        title: baseTitle,
        sub: baseSub
      };
  }
}

function updateTimeBanner(){
  const bannerEl = document.getElementById("timeBanner");
  const artEl    = document.getElementById("timeBannerArt");
  const titleEl  = document.getElementById("timeBannerTitle");
  const subEl    = document.getElementById("timeBannerSub");
  if(!bannerEl || !artEl || !titleEl || !subEl) return;

  const hour = new Date().getHours();
  const cfg = pickTimeBannerConfig(hour);
  const text = buildBannerText(cfg.baseTitle, cfg.baseSub, lastWeatherKind);

  titleEl.textContent = text.title;
  subEl.textContent   = text.sub;
  artEl.style.backgroundImage = `url(${getArtForBanner(cfg.theme, lastWeatherKind)})`;
}

/* ---------- –ø–æ–≥–æ–¥–∞ (OpenWeather) ---------- */
const WEATHER_API_URL = "https://api.openweathermap.org/data/2.5/weather";

function detectWeatherKind(main){
  if(!main) return null;
  const m = main.toLowerCase();
  if(m.includes("clear")) return "clear";
  if(m.includes("rain") || m.includes("drizzle") || m.includes("thunder")) return "rain";
  if(m.includes("snow")) return "snow";
  if(m.includes("cloud")) return "clouds";
  return "other";
}

async function fetchWeather(){
  const cityEl   = document.getElementById("weatherCity");
  const mainEl   = document.getElementById("weatherMain");
  const tempEl   = document.getElementById("weatherTemp");
  const metaEl   = document.getElementById("weatherMeta");
  if(!cityEl || !tempEl) return;

  if(!CONFIG.city || !CONFIG.weatherApiKey){
    cityEl.textContent = CONFIG.city || "–ü–æ–≥–æ–¥–∞";
    mainEl.textContent = "";
    tempEl.textContent = "–î–æ–±–∞–≤—å –≥–æ—Ä–æ–¥ –∏ API-–∫–ª—é—á –≤ ‚öôÔ∏è";
    metaEl.textContent = "";
    lastWeatherKind = null;
    updateTimeBanner();
    return;
  }

  const url = `${WEATHER_API_URL}?q=${encodeURIComponent(CONFIG.city)}&appid=${CONFIG.weatherApiKey}&units=metric&lang=ru`;

  try{
    tempEl.textContent = "–ó–∞–≥—Ä—É–∂–∞—é...";
    metaEl.textContent = "";

    const res = await fetch(url);
    if(!res.ok) throw new Error("bad status");
    const data = await res.json();

    const name = data.name || CONFIG.city;
    const w    = (data.weather && data.weather[0]) || {};
    const main = w.description || w.main || "";

    const t  = Math.round(data.main.temp);
    const tf = Math.round(data.main.feels_like);
    const hum = Math.round(data.main.humidity);

    cityEl.textContent = name;
    mainEl.textContent = main ? (main[0].toUpperCase() + main.slice(1)) : "";
    tempEl.textContent = `${t}¬∞C`;
    metaEl.textContent = `–û—â—É—â–∞–µ—Ç—Å—è –∫–∞–∫ ${tf}¬∞C ¬∑ –≤–ª–∞–∂–Ω–æ—Å—Ç—å ${hum}%`;

    lastWeatherKind = detectWeatherKind(w.main || "");
    updateTimeBanner();
  }catch(e){
    cityEl.textContent = CONFIG.city || "–ü–æ–≥–æ–¥–∞";
    mainEl.textContent = "";
    tempEl.textContent = "–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å";
    metaEl.textContent = "–ü—Ä–æ–≤–µ—Ä—å –∏–Ω—Ç–µ—Ä–Ω–µ—Ç –∏–ª–∏ API-–∫–ª—é—á.";
    lastWeatherKind = null;
    updateTimeBanner();
  }
}

/* ---------- –ø—Ä–∏–º–µ–Ω—è–µ–º –∫–æ–Ω—Ñ–∏–≥ –∫ UI ---------- */
function applyConfigToUI(){
  if(welcomeEl) welcomeEl.textContent = CONFIG.welcome;

  document.querySelectorAll(".slide").forEach(slide=>{
    const band = slide.dataset.net === "r2d5" ? "5" : "24";
    const ssidMain = slide.querySelector(".slide-ssid-main");
    const ssidSub  = slide.querySelector(".slide-ssid-sub");
    const cap      = slide.querySelector(".slide-caption");

    if(ssidMain) ssidMain.textContent = getSsidForBand(band);
    if(ssidSub)  ssidSub.textContent  = band === "5" ? "5 GHz" : "2.4 GHz";
    if(cap){
      cap.textContent = band === "5"
        ? `${getSsidForBand("5")} ¬∑ –±—ã—Å—Ç—Ä–µ–µ, –µ—Å–ª–∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è`
        : `${getSsidForBand("24")} ¬∑ —Å—Ç–∞–±–∏–ª—å–Ω–µ–µ –Ω–∞ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–∏`;
    }
  });

  updateMeta();
}

/* ---------- —Ä–∞–∑–º–µ—Ä—ã ---------- */
function recalcWidth(){
  slideWidth = carousel.offsetWidth;
  track.style.transition = "none";
  track.style.transform = `translateX(${-index * slideWidth}px)`;
  void track.offsetWidth;
  track.style.transition = transitionValue;
  updateMeta();
}

/* ---------- –ø–æ–¥–ø–∏—Å–∏ / —Ç–æ—á–∫–∏ ---------- */
function updateMeta(){
  const logical = (index - 1 + REAL_COUNT) % REAL_COUNT;
  dots.forEach((d,i)=>d.classList.toggle("active", i === logical));

  const band = logical === 0 ? "5" : "24";
  const ssid = getSsidForBand(band);

  let base =
    band === "5"
      ? `–í—ã–±—Ä–∞–Ω–∞ ${ssid} (5 GHz) ‚Äî –±—ã—Å—Ç—Ä–µ–µ, –µ—Å–ª–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç 5 GHz.`
      : `–í—ã–±—Ä–∞–Ω–∞ ${ssid} (2.4 GHz) ‚Äî —Å—Ç–∞–±–∏–ª—å–Ω–µ–µ –Ω–∞ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–∏.`;

  if(isIOS){
    base += " –ï—Å–ª–∏ —Å–º–æ—Ç—Ä–∏—à—å —ç—Ç—É —Å—Ç—Ä–∞–Ω–∏—Ü—É –Ω–∞ –¥—Ä—É–≥–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ ‚Äî –Ω–∞–≤–µ–¥–∏ –ö–∞–º–µ—Ä—É iPhone –Ω–∞ QR. –ï—Å–ª–∏ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –æ—Ç–∫—Ä—ã—Ç–∞ –Ω–∞ —Å–∞–º–æ–º iPhone, –∑–∞–π–¥–∏ –≤ ¬´–ù–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Üí Wi-Fi¬ª –∏ –≤—ã–±–µ—Ä–∏ —Å–µ—Ç—å –≤—Ä—É—á–Ω—É—é.";
  }else if(isAndroid){
    base += " –ï—Å–ª–∏ —ç—Ç–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –æ—Ç–∫—Ä—ã—Ç–∞ –Ω–∞ —Å–∞–º–æ–º Android ‚Äî –º–æ–∂–Ω–æ –Ω–∞–∂–∞—Ç—å ¬´–ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏¬ª –∏–ª–∏ –≤–≤–µ—Å—Ç–∏ —Å–µ—Ç—å –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö Wi-Fi. –ï—Å–ª–∏ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–∞ –¥—Ä—É–≥–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ ‚Äî –æ—Ç—Å–∫–∞–Ω–∏—Ä—É–π QR-–∫–æ–¥ —Å Android.";
  }else{
    base += " –ù–∞ –Ω–æ—É—Ç–±—É–∫–µ —É–¥–æ–±–Ω–µ–µ –≤—Å–µ–≥–æ –æ—Ç—Å–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å QR —Å —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –∏–ª–∏ —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –ø–∞—Ä–æ–ª—å.";
  }

  helperText.textContent = base;
  document.getElementById("qrBox").style.display = "none";

  updateHeroArt();
}

/* ---------- –Ω–∞–≤–∏–≥–∞—Ü–∏—è ---------- */
function goTo(newIndex){
  if(isAnimating) return;
  isAnimating = true;
  index = newIndex;
  track.style.transition = transitionValue;
  track.style.transform = `translateX(${-index * slideWidth}px)`;
}

function nextSlide(){ goTo(index + 1); }
function prevSlide(){ goTo(index - 1); }

track.addEventListener("transitionend", e=>{
  if(e.propertyName !== "transform") return;

  if(index === 0){
    track.style.transition = "none";
    index = REAL_COUNT;
    track.style.transform = `translateX(${-index * slideWidth}px)`;
    void track.offsetWidth;
    track.style.transition = transitionValue;
  }else if(index === slides.length - 1){
    track.style.transition = "none";
    index = 1;
    track.style.transform = `translateX(${-index * slideWidth}px)`;
    void track.offsetWidth;
    track.style.transition = transitionValue;
  }

  updateMeta();
  isAnimating = false;
});

/* ---------- —Å–≤–∞–π–ø –ø–æ –≤—Å–µ–π –∫–∞—Ä—Ç–æ—á–∫–µ (–∫–∞—Ä—É—Å–µ–ª—å —Å–µ—Ç–µ–π) ---------- */
let startX = null;
let startY = null;
let draggingMouse = false;

function swipeStart(e){
  const target = e.target;
  if (target.closest('button') || target.closest('.nav-arrow') || target.closest('a') || target.closest('.admin-inner')) {
    return;
  }
  const p = e.touches ? e.touches[0] : e;
  startX = p.clientX;
  startY = p.clientY;
  draggingMouse = !e.touches;
}

function swipeMove(e){
  if(startX === null) return;
  const p = e.touches ? e.touches[0] : e;
  const dx = p.clientX - startX;
  const dy = p.clientY - startY;

  if(Math.abs(dx) > Math.abs(dy) + 10){
    e.preventDefault();
  }
}

function swipeEnd(e){
  if(startX === null) return;
  const p = e.changedTouches ? e.changedTouches[0] : e;
  const dx = p.clientX - startX;

  if(Math.abs(dx) > 40){
    if(dx < 0) nextSlide();
    else       prevSlide();
  }

  startX = startY = null;
  draggingMouse = false;
}

card.addEventListener("touchstart", swipeStart, {passive:true});
card.addEventListener("touchmove",  swipeMove,  {passive:false});
card.addEventListener("touchend",   swipeEnd);
card.addEventListener("mousedown",  swipeStart);
card.addEventListener("mousemove",  e=>{ if(draggingMouse) swipeMove(e); });
card.addEventListener("mouseup",    swipeEnd);
card.addEventListener("mouseleave", e=>{ if(draggingMouse) swipeEnd(e); });

/* ---------- QR / –∞–≤—Ç–æ / –∫–æ–ø–∏—è ---------- */
function showQR(){
  const ssid = getCurrentSsid();
  const payload = `WIFI:T:WPA;S:${ssid};P:${CONFIG.pass};;`;

  if(!qrObj){
    qrObj = new QRCode(document.getElementById("qrCanvas"), {
      width:200,height:200
    });
  }
  qrObj.clear();
  qrObj.makeCode(payload);
  document.getElementById("qrBox").style.display = "block";
  playClickSound();
}

function autoConnect(){
  const ssid = getCurrentSsid();
  playClickSound();
  location.href = `WIFI:T:WPA;S:${ssid};P:${CONFIG.pass};;`;
}

function copyPass(){
  navigator.clipboard.writeText(CONFIG.pass).then(()=>{
    alert("–ü–∞—Ä–æ–ª—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω");
    playClickSound();
  }).catch(()=>{
    alert("–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å. –ü–æ–ø—Ä–æ–±—É–π –≤—Ä—É—á–Ω—É—é.");
  });
}

/* ---------- —Å—Å—ã–ª–∫–∞ –Ω–∞ –∫–∞—Ä—Ç—É ---------- */
function openMaps(){
  const url = CONFIG.mapsUrl || defaultConfig.mapsUrl;
  const finalUrl = /^https?:\/\//i.test(url) ? url : ("https://" + url);
  window.open(finalUrl, "_blank");
}

/* ---------- –∑–≤—É–∫ ---------- */
function playClickSound(){
  try{
    if(!audioCtx){
      audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    }
    const osc = audioCtx.createOscillator();
    const gain = audioCtx.createGain();
    osc.type = "sine";
    osc.frequency.value = 880;

    osc.connect(gain);
    gain.connect(audioCtx.destination);

    const now = audioCtx.currentTime;
    gain.gain.setValueAtTime(0.04, now);
    gain.gain.exponentialRampToValueAtTime(0.00001, now + 0.15);

    osc.start(now);
    osc.stop(now + 0.16);
  }catch(e){}
}

/* ---------- —Ç–µ–º–∞ ---------- */
function toggleTheme(){
  const body = document.body;
  const isLight = body.classList.contains("light");

  body.classList.toggle("light", !isLight);
  body.classList.toggle("neon", isLight);

  localStorage.theme = body.classList.contains("light") ? "light" : "dark";
  document.querySelector(".theme-toggle").textContent =
    body.classList.contains("light") ? "üåô" : "‚òÄÔ∏è";

  updateHeroArt();
  updateTimeBanner();
}

(function initTheme(){
  const stored = localStorage.theme;
  const prefersDark = window.matchMedia &&
                      window.matchMedia("(prefers-color-scheme: dark)").matches;

  if(stored === "light"){
    document.body.classList.add("light");
  }else if(stored === "dark" || (!stored && prefersDark)){
    document.body.classList.add("neon");
  }else{
    document.body.classList.add("light");
  }

  document.querySelector(".theme-toggle").textContent =
    document.body.classList.contains("light") ? "üåô" : "‚òÄÔ∏è";
})();

/* ---------- —Å—Ç–∞—Ç—É—Å –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞ ---------- */
function updateOnlineStatus(){
  if(!netStatus) return;
  if(navigator.onLine){
    netStatus.textContent = "–°—Ç–∞—Ç—É—Å –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞: –æ–Ω–ª–∞–π–Ω ‚úÖ";
  }else{
    netStatus.textContent = "–°—Ç–∞—Ç—É—Å –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞: –æ—Ñ–ª–∞–π–Ω ‚õî (–ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–æ—É—Ç–µ—Ä –∏–ª–∏ –∫–∞–±–µ–ª—å)";
  }
}
window.addEventListener("online", updateOnlineStatus);
window.addEventListener("offline", updateOnlineStatus);

/* ---------- –∞–≤—Ç–æ-–≤—ã–±–æ—Ä —Å–µ—Ç–∏ –¥–ª—è —Å—Ç–∞—Ä—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ ---------- */
(function autoPick(){
  const logicalIndex = (oldAndroid || oldIOS) ? 1 : 0; // 0 = 5GHz, 1 = 2.4GHz
  index = logicalIndex + 1;
})();

/* ---------- –∞–¥–º–∏–Ω–∫–∞ ---------- */
function toggleAdmin(){
  adminPanelEl.classList.toggle("open");
  if(adminPanelEl.classList.contains("open")){
    fillAdminForm();
  }
}

function fillAdminForm(){
  document.getElementById("admWelcome").value    = CONFIG.welcome;
  document.getElementById("admSsid5").value      = CONFIG.ssid5;
  document.getElementById("admSsid24").value     = CONFIG.ssid24;
  document.getElementById("admPass").value       = CONFIG.pass;
  document.getElementById("admMaps").value       = CONFIG.mapsUrl || "";
  document.getElementById("admCity").value       = CONFIG.city || "";
  document.getElementById("admWeatherKey").value = CONFIG.weatherApiKey || "";
}

function saveConfig(){
  CONFIG.welcome      = document.getElementById("admWelcome").value || defaultConfig.welcome;
  CONFIG.ssid5        = document.getElementById("admSsid5").value   || defaultConfig.ssid5;
  CONFIG.ssid24       = document.getElementById("admSsid24").value  || defaultConfig.ssid24;
  CONFIG.pass         = document.getElementById("admPass").value    || defaultConfig.pass;
  CONFIG.mapsUrl      = document.getElementById("admMaps").value    || defaultConfig.mapsUrl;
  CONFIG.city         = document.getElementById("admCity").value    || defaultConfig.city;
  CONFIG.weatherApiKey= document.getElementById("admWeatherKey").value || "";

  saveConfigToStorage();
  applyConfigToUI();
  updateTimeBanner();
  fetchWeather();
  toggleAdmin();
}

function resetConfig(){
  CONFIG = { ...defaultConfig };
  saveConfigToStorage();
  applyConfigToUI();
  updateTimeBanner();
  fetchWeather();
  toggleAdmin();
}

/* ---------- —Å—Ç–∞—Ä—Ç ---------- */
window.addEventListener("load", ()=>{
  recalcWidth();
  applyConfigToUI();
  updateOnlineStatus();
  updateHeroArt();
  updateTimeBanner();
  fetchWeather();
});
window.addEventListener("resize", recalcWidth);
</script>
</body>
</html>
